<div class="chat-wrapper">
  <div class="chat-messages">
    @for (msg of messages; track $index) {
      <div
        class="chat-message"
        [class.msg-user]="msg.role === 'user'"
        [class.msg-assistant]="msg.role === 'assistant'"
      >
        <div class="msg-content">
          {{ msg.content }}
        </div>

        @if (msg.role === 'assistant' && msg.sources && msg.sources !== 'error') {
          <div class="msg-sources">
            <strong>Источники:</strong>
            <span>{{ msg.sources }}</span>
          </div>
        }
      </div>
    }

    @if (isLoading) {
      <div class="chat-loading">
        Модель думает…
      </div>
    }

    @if (error) {
      <div class="chat-error">
        {{ error }}
      </div>
    }
  </div>

  <form
    class="chat-input"
    (submit)="onSend(); $event.preventDefault()"
  >
    <input
      type="text"
      [value]="currentQuestion"
      (input)="currentQuestion = $any($event.target).value"
      placeholder="Задайте вопрос про ВШЭ…"
      [disabled]="isLoading"
    />
    <button type="submit" [disabled]="isLoading || !currentQuestion.trim()">
      Отправить
    </button>
  </form>
</div>
